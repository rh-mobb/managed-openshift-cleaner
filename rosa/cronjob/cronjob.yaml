apiVersion: batch/v1beta1
kind: CronJob
metadata:
  annotations:
    alpha.image.policy.openshift.io/resolve-names: '*'
    app.openshift.io/vcs-ref: main
    app.openshift.io/vcs-uri: https://gitlab.consulting.redhat.com/mobb/osd-cleaner
    deployment.kubernetes.io/revision: "2"
  labels:
    app: rosa-cleaner
    app.kubernetes.io/component: rosa-cleaner
    app.kubernetes.io/instance: rosa-cleaner
    app.kubernetes.io/name: python
    app.kubernetes.io/part-of: rosa-cleaner-app
    app.openshift.io/runtime: python
    app.openshift.io/runtime-version: 3.8-ubi7
  name: rosa-cleaner
  namespace: rosa-cleaner
spec:
  schedule: "0 0 * * *"
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - image: image-registry.openshift-image-registry.svc:5000/rosa-cleaner/rosa-cleaner:latest
            imagePullPolicy: Always
            name: rosa-cleaner
            command:
            - ./rosa-cleaner.py
            volumeMounts:
            - name: rosa-auth
              mountPath: /auth
              readOnly: true
            env:
            - name: OCM_JSON
              value: /auth/.ocm.json
            - name: DELETE
              value: "1" # change to 1 to delete the old clusters
            - name: SKIP_CLUSTERS
              value: "" # csv of clusters to skip.  mobb-infra is always skipped.
          volumes:
          - name: rosa-auth
            secret:
              secretName: openshift-cluster-manager-credentials
          restartPolicy: OnFailure
